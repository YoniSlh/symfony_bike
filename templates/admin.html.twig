{% extends 'base.html.twig' %}

{% block content %}
	{% include '_header_admin.html.twig' %}
	{% block flash %}
		{% for message in app.flashes('success') %}
			<div class="flash-success">
				<button class="close-btn" onclick="this.parentElement.style.display='none';">×</button>
				{{ message }}
			</div>
		{% endfor %}
		{% for message in app.flashes('error') %}
			<div class="flash-error">
				<button class="close-btn" onclick="this.parentElement.style.display='none';">×</button>
				{{ message }}
			</div>
		{% endfor %}
	{% endblock %}
	<div class="conteneurAdmin">
		<h2 class="titreAdmin">Nombre de produits par catégorie</h2>
		<div class="divTableAdmin">
			<table class="tableAdmin">
				<thead>
					<tr>
						<th>Catégorie</th>
						<th>Nombre de produits</th>
					</tr>
				</thead>
				<tbody>
					{% for category, count in nbProductsByCategory %}
						<tr>
							<td>{{ category }}</td>
							<td>{{ count }}</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="2">Aucune catégorie trouvée.</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	<div class="conteneurAdmin">
		<h2 class="titreAdmin">5 dernières commandes passées</h2>
		<div class="divTableAdmin">
			<table class="tableAdmin">
				<thead>
					<tr>
						<th>ID</th>
						<th>Référence</th>
						<th>Utilisateur</th>
						<th>Date</th>
						<th>Status</th>
						<th>Montant</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for cinqDernieresCommande in cinqDernieresCommandes %}
						<tr>
							<td>{{ cinqDernieresCommande.id }}</td>
							<td>{{ cinqDernieresCommande.reference }}</td>
							<td>
								{% if cinqDernieresCommande.user %}
									{{ cinqDernieresCommande.user.firstName }}
									{{ cinqDernieresCommande.user.lastName }}
								{% else %}
									Inconnu
								{% endif %}
							</td>
							<td>{{ cinqDernieresCommande.createdAt|date('d/m/Y') }}
								à
								{{ cinqDernieresCommande.createdAt|date('H') }}h{{ cinqDernieresCommande.createdAt|date('i') }}</td>
							<td>{{ cinqDernieresCommande.status.value }}</td>
							<td>{{ cinqDernieresCommande.price }}
								€</td>

							<td>
								<div class="btnContainer">
									<button class="btnModifier" onclick="window.location.href='{{ path('app_admin_editProduct', {'id': cinqDernieresCommande.id}) }}'">Modifier</button>
									<form method="post" action="{{ path('app_admin_deleteProduct', {'id': cinqDernieresCommande.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette commande ?');">
										<button type="submit" class="btnDelete">Supprimer</button>
									</form>
								</td>
							</td>
						</tr>
					</div>
				</tbody>
			</td>
		</tr>
	{% else %}
		<tr>
			<td colspan="6" class="tdAucun">Aucune commande trouvée</td>
		</tr>
	{% endfor %}
</tbody>
</table>
</div>
</div>
<div class="conteneurAdmin">
<h2 class="titreAdmin">Ratio de disponibilité des produits (en stock, en rupture, en précommande)</h2>
<div class="divTableAdmin">
<p>Nombre de produits : {{ totalProduits }}</p>
<table class="tableAdmin">
<thead>
	<tr>
		<th>Statut</th>
		<th>Nombre de produits</th>
		<th>Ratio</th>
	</tr>
</thead>
<tbody>
	<tr>
		<td>En stock</td>
		<td>{{ enStock }}</td>
		<td>{{ ratioEnStock|number_format(2, ',', ' ') }} %</td>
	</tr>
	<tr>
		<td>En rupture</td>
		<td>{{ enRupture }}</td>
		<td>{{ ratioEnRupture|number_format(2, ',', ' ') }} %</td>
	</tr>
	<tr>
		<td>En précommande</td>
		<td>{{ enPrecommande }}</td>
		<td>{{ ratioEnPrecommande|number_format(2, ',', ' ') }} %</td>
	</tr>
</tbody></table></div></div>
<div class="conteneurAdmin">
<div class="divTableAdmin">
    <h2 class="titreAdmin">Montant total des ventes réalisées par mois sur les 12 derniers mois</h2>
	<p>Montant total : {{ montantTotalVentes | number_format(2, ',', ' ') }} €</p>
    <table class="tableAdmin">
        <thead>
            <tr>
                <th>Mois</th>
                <th>Montant des ventes</th>
            </tr>
        </thead>
        <tbody>
            {% for mois, montant in ventesParMois %}
            <tr>
                <td>{{ mois }}</td>
                <td>{{ montant | number_format(2, ',', ' ') }} €</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="2" class="tdAucun">Aucune vente pour les 12 derniers mois</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>	
</div>
</div>{% include '_footer.html.twig' %}{% endblock %}
